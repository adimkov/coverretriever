<Window x:Class="CoverRetriever.View.Shell"
		xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" 
		xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" 
		xmlns:cmd="clr-namespace:Microsoft.Practices.Prism.Commands" 
		xmlns:converter="clr-namespace:CoverRetriever.Converter" 
		xmlns:resources="clr-namespace:CoverRetriever.Resources" 
		xmlns:fluid="clr-namespace:FluidKit.Controls;assembly=FluidKit" 
		xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
		xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
		xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
		xmlns:prism="clr-namespace:Microsoft.Practices.Prism.Interactivity.InteractionRequest;assembly=Microsoft.Practices.Prism.Interactivity" 
		xmlns:interaction="clr-namespace:CoverRetriever.Interaction" 
		xmlns:view="clr-namespace:CoverRetriever.View" 
		xmlns:toolkit="clr-namespace:Microsoft.Windows.Controls;assembly=WPFToolkit.Extended" 
		xmlns:helper="clr-namespace:CoverRetriever.Helpers" 
		xmlns:model="clr-namespace:CoverRetriever.Model" mc:Ignorable="d" 
		cmd:Loaded.Command="{Binding LoadedCommand}"
		Title="Shell" Width="800" Height="600">
	<Window.Resources>
		<converter:TreePathContructor x:Key="treePathContructor"/>
		<converter:CoverOrganizerToImageConverter x:Key="coverOrganizerToImageConverter"/>
		<resources:CoverRetrieverResourcesWrapper x:Key="coverRetrieverResources"/>

		<HierarchicalDataTemplate DataType="{x:Type model:Folder}" ItemsSource="{Binding Children}">
			<TextBlock Text="{Binding Path=Name}"/>
		</HierarchicalDataTemplate>
		<HierarchicalDataTemplate DataType="{x:Type model:AudioFile}">
			<TextBlock Text="{Binding Path=Name}"/>
		</HierarchicalDataTemplate>

		<DataTemplate x:Key="SuggestedCoverDataTemplate_Reflection">
			<Grid>
				<Grid.RowDefinitions>
					<RowDefinition Height="0.5*"/>
					<RowDefinition Height="0.5*"/>
				</Grid.RowDefinitions>
				<Border x:Name="ElementVisual"
						BorderThickness="2"
						BorderBrush="LightYellow"
						Background="Black"
						Padding="2">
					<Image Source="{Binding ThumbCoverUri}" Stretch="Uniform"/>
				</Border>
				<Rectangle OpacityMask="{StaticResource ReflectionBrush}"
						   Grid.Row="1">
					<Rectangle.Fill>
						<VisualBrush Visual="{Binding ElementName=ElementVisual}">
							<VisualBrush.RelativeTransform>
								<ScaleTransform ScaleX="1"
												ScaleY="-1"
												CenterX="0.5"
												CenterY="0.5" />
							</VisualBrush.RelativeTransform>
						</VisualBrush>
					</Rectangle.Fill>
				</Rectangle>
			</Grid>
		</DataTemplate>
	</Window.Resources>
	<i:Interaction.Triggers>
		<prism:InteractionRequestTrigger SourceObject="{Binding PreviewCoverRequest}">
			<interaction:ContentChildWindow MinWidth="400" MinHeight="400" Width="600" Height="600">
				<view:CoverPreviewView/>
			</interaction:ContentChildWindow>
		</prism:InteractionRequestTrigger>
	</i:Interaction.Triggers>
	<toolkit:BusyIndicator  IsBusy="{Binding IsBusy}" BusyContent="{Binding OperationName}">
	<Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="250*" />
			<RowDefinition Height="279*" />
			<RowDefinition Height="32*" />
		</Grid.RowDefinitions>
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="40*" />
			<ColumnDefinition Width="4" />
			<ColumnDefinition Width="60*" />
		</Grid.ColumnDefinitions>
		<Border x:Name="FileSystemBorder" Grid.RowSpan="2" >
				<TreeView ItemsSource="{Binding FileSystem}" 
					  cmd:SelectedItemChanged.Command="{Binding FileSystemSelectedItemChangedCommand}" 
					  cmd:SelectedItemChanged.CommandParameter="{Binding SelectedItem, RelativeSource={RelativeSource Self}}"
					  helper:TreeViewExtensions.SelectedItem="{Binding SelectedFileSystemItem, Converter={StaticResource treePathContructor}}">
				</TreeView>
		</Border>
		<GridSplitter Grid.Column="1" Grid.RowSpan="3" HorizontalAlignment="Stretch"/>
		<Border x:Name="FileInfoBorder" DataContext="{Binding FileDetails}" Grid.Column="2" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Margin="0,0,0,0" Grid.RowSpan="1">
			<Grid>
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="50" />
					<ColumnDefinition Width="180" />
					<ColumnDefinition Width="30" />
					<ColumnDefinition Width="50" />
				</Grid.ColumnDefinitions>
				<Grid.RowDefinitions>
					<RowDefinition Height="25" />
					<RowDefinition Height="25" />
					<RowDefinition Height="25" />
					<RowDefinition Height="25" />
					<RowDefinition Height="*" />
				</Grid.RowDefinitions>
				<TextBlock Text="{Binding CoverRetrieverResources.TextFileDetails, Source={StaticResource coverRetrieverResources}}" Grid.ColumnSpan="4" />
				<TextBlock Text="{Binding CoverRetrieverResources.TextTrackName, Source={StaticResource coverRetrieverResources}}" Grid.Row="1"/>
				<TextBox Text="{Binding TrackName, Mode=OneWay}" IsReadOnly="True" Grid.Column="1" Grid.Row="1"/>
				<TextBlock Text="{Binding CoverRetrieverResources.TextArtist, Source={StaticResource coverRetrieverResources}}" Grid.Row="2"/>
				<TextBox Text="{Binding Artist, Mode=OneWay}" IsReadOnly="True" Grid.Column="1" Grid.Row="2"/>
				<TextBlock Text="{Binding CoverRetrieverResources.TextAlbum, Source={StaticResource coverRetrieverResources}}" Grid.Row="3"/>
				<TextBox Text="{Binding Album, Mode=OneWay}" IsReadOnly="True" Grid.Column="1" Grid.Row="3"/>
				<TextBlock Text="{Binding CoverRetrieverResources.TextYear, Source={StaticResource coverRetrieverResources}}" Grid.Column="2" Grid.Row="3"/>
				<TextBox Text="{Binding Year, Mode=OneWay}" IsReadOnly="True" Grid.Column="3" Grid.Row="3"/>
				<Border Grid.Row="4" Height="150" Width="150" Padding="2" BorderThickness="1" CornerRadius="2" BorderBrush="Black" Grid.ColumnSpan="2" HorizontalAlignment="Left">
					<Image Source="{Binding CoverOrganizer, Converter={StaticResource coverOrganizerToImageConverter}}"/>
				</Border>
			</Grid>
		</Border>
		<Border x:Name="SuggestedCoversBorder" Grid.Row="1" Grid.Column="2" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Grid.RowSpan="1" Margin="0,0 ,0,0">
			<fluid:ElementFlow x:Name="elementFlow"
							   ItemsSource="{Binding SuggestedCovers}" 
							   SelectedItem="{Binding SelectedSuggestedCover}"
							   ItemTemplate="{StaticResource SuggestedCoverDataTemplate_Reflection}"
							   cmd:MouseDoubleClick.Command="{Binding PreviewCoverCommand}"
							   cmd:MouseDoubleClick.CommandParameter="{Binding Path=SelectedItem, RelativeSource={RelativeSource Self}}"
							   ItemGap="0.5"
							   FrontItemGap="0"
							   PopoutDistance="1"
							   ElementHeight="700" TiltAngle="50">
				<fluid:ElementFlow.Layout>
					<fluid:CoverFlow />
				</fluid:ElementFlow.Layout>
				<fluid:ElementFlow.Camera>
				<PerspectiveCamera FieldOfView="27"
								   Position="0,0,5" 
								   LookDirection="-5.32689704113657E-06,0.0660727483790081,-0.997814808415504" />
				</fluid:ElementFlow.Camera>
			</fluid:ElementFlow>
		</Border>
		<Border x:Name="CommandBorder" 
				Grid.Row="3"
				Grid.Column="2"
				HorizontalAlignment="Right"
				VerticalAlignment="Center">
			<StackPanel>
				<Button Content="{Binding Path=CoverRetrieverResources.TextSaveCoverInToDirectory, Source={StaticResource coverRetrieverResources}}"
						Command="{Binding SaveCoverCommand}"
						CommandParameter="{Binding Path=SelectedItem, ElementName=elementFlow}"
						MinWidth="75"/>
			</StackPanel>
		</Border>
	</Grid>
	</toolkit:BusyIndicator>
</Window>
